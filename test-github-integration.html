<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #4A90E2;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            background: #f8fafc;
        }
        
        .test-section h3 {
            color: #2d3748;
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-group small {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
            display: block;
        }
        
        button {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
        }
        
        button:hover {
            background: #357ABD;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .status {
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: 600;
            display: inline-block;
            margin: 5px 0;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .log {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            white-space: pre-wrap;
        }
        
        .repo-info {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .repo-info h4 {
            color: #234e52;
            margin: 0 0 10px 0;
        }
        
        .repo-info a {
            color: #319795;
            text-decoration: none;
        }
        
        .repo-info a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß GitHub Integration Test</h1>
        
        <div class="test-section">
            <h3>1. Authentication Setup</h3>
            <div class="form-group">
                <label for="testUsername">GitHub Username:</label>
                <input type="text" id="testUsername" value="linhfishCR7" placeholder="your-github-username">
            </div>
            <div class="form-group">
                <label for="testToken">GitHub Personal Access Token:</label>
                <input type="password" id="testToken" value="" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                <small>Token should have 'repo' or 'public_repo' scope</small>
            </div>
            <button onclick="testAuthentication()">Test Authentication</button>
            <div id="authStatus"></div>
        </div>
        
        <div class="test-section">
            <h3>2. Repository Operations</h3>
            <div class="form-group">
                <label for="testRepoName">Test Repository Name:</label>
                <input type="text" id="testRepoName" value="cordova-test-app" placeholder="test-repo-name">
            </div>
            <button onclick="testCreateRepository()" id="createRepoBtn" disabled>Create Test Repository</button>
            <button onclick="testCheckRepository()" id="checkRepoBtn" disabled>Check Repository Exists</button>
            <button onclick="testDeleteRepository()" id="deleteRepoBtn" disabled>Delete Test Repository</button>
            <div id="repoStatus"></div>
            <div id="repoInfo"></div>
        </div>
        
        <div class="test-section">
            <h3>3. File Upload Test</h3>
            <button onclick="testFileUpload()" id="uploadBtn" disabled>Test File Upload</button>
            <div id="uploadStatus"></div>
        </div>
        
        <div class="test-section">
            <h3>4. User Repositories</h3>
            <button onclick="testGetRepositories()" id="getReposBtn" disabled>Get My Repositories</button>
            <div id="reposStatus"></div>
            <div id="reposList"></div>
        </div>
        
        <div class="test-section">
            <h3>Test Log</h3>
            <div id="testLog" class="log">Ready to test GitHub integration...\n</div>
            <button onclick="clearLog()">Clear Log</button>
        </div>
    </div>

    <!-- Include GitHub integration -->
    <script src="js/github.js"></script>

    <script>
        let github = new GitHubIntegration();
        let testLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            testLog.push(logEntry);
            
            const logElement = document.getElementById('testLog');
            if (logElement) {
                logElement.textContent = testLog.join('\n') + '\n';
                logElement.scrollTop = logElement.scrollHeight;
            }
            
            console.log(logEntry);
        }
        
        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `<div class="status ${type}">${message}</div>`;
            }
        }
        
        function enableButtons() {
            document.getElementById('createRepoBtn').disabled = false;
            document.getElementById('checkRepoBtn').disabled = false;
            document.getElementById('deleteRepoBtn').disabled = false;
            document.getElementById('uploadBtn').disabled = false;
            document.getElementById('getReposBtn').disabled = false;
        }
        
        async function testAuthentication() {
            const username = document.getElementById('testUsername').value;
            const token = document.getElementById('testToken').value;
            
            if (!username || !token) {
                updateStatus('authStatus', 'Please enter both username and token', 'error');
                return;
            }
            
            try {
                log('Testing GitHub authentication...');
                updateStatus('authStatus', 'Authenticating...', 'warning');
                
                await github.authenticate(username, token);
                
                // Test token permissions
                const permissions = await github.validateTokenPermissions();
                
                log(`Authentication successful! User: ${github.username}`, 'success');
                log(`Token scopes: ${permissions.scopes.join(', ')}`, 'info');
                
                updateStatus('authStatus', 
                    `‚úÖ Authenticated as ${github.username}<br>Scopes: ${permissions.scopes.join(', ')}`, 
                    'success'
                );
                
                enableButtons();
                
            } catch (error) {
                log(`Authentication failed: ${error.message}`, 'error');
                updateStatus('authStatus', `‚ùå Authentication failed: ${error.message}`, 'error');
            }
        }
        
        async function testCreateRepository() {
            const repoName = document.getElementById('testRepoName').value;
            
            if (!repoName) {
                updateStatus('repoStatus', 'Please enter a repository name', 'error');
                return;
            }
            
            try {
                log(`Creating repository: ${repoName}...`);
                updateStatus('repoStatus', 'Creating repository...', 'warning');
                
                const appConfig = {
                    appName: repoName,
                    description: 'Test repository created by Cordova App Generator',
                    authorName: 'Test User',
                    authorEmail: 'test@example.com'
                };
                
                const repository = await github.createRepository(appConfig);
                
                log(`Repository created successfully: ${repository.fullName}`, 'success');
                updateStatus('repoStatus', `‚úÖ Repository created: ${repository.fullName}`, 'success');
                
                // Show repository info
                document.getElementById('repoInfo').innerHTML = `
                    <div class="repo-info">
                        <h4>üìÅ ${repository.name}</h4>
                        <p><strong>Full Name:</strong> ${repository.fullName}</p>
                        <p><strong>Description:</strong> ${repository.description}</p>
                        <p><strong>URL:</strong> <a href="${repository.htmlUrl}" target="_blank">${repository.htmlUrl}</a></p>
                        <p><strong>Clone URL:</strong> ${repository.cloneUrl}</p>
                        <p><strong>Created:</strong> ${repository.created ? 'Yes' : 'Already existed'}</p>
                    </div>
                `;
                
            } catch (error) {
                log(`Repository creation failed: ${error.message}`, 'error');
                updateStatus('repoStatus', `‚ùå Creation failed: ${error.message}`, 'error');
            }
        }
        
        async function testCheckRepository() {
            const repoName = document.getElementById('testRepoName').value;
            
            if (!repoName) {
                updateStatus('repoStatus', 'Please enter a repository name', 'error');
                return;
            }
            
            try {
                log(`Checking if repository exists: ${repoName}...`);
                
                const exists = await github.checkRepositoryExists(repoName);
                
                log(`Repository ${repoName} ${exists ? 'exists' : 'does not exist'}`, 'info');
                updateStatus('repoStatus', 
                    `${exists ? '‚úÖ' : '‚ùå'} Repository ${repoName} ${exists ? 'exists' : 'does not exist'}`, 
                    exists ? 'success' : 'warning'
                );
                
            } catch (error) {
                log(`Repository check failed: ${error.message}`, 'error');
                updateStatus('repoStatus', `‚ùå Check failed: ${error.message}`, 'error');
            }
        }
        
        async function testDeleteRepository() {
            const repoName = document.getElementById('testRepoName').value;
            
            if (!repoName) {
                updateStatus('repoStatus', 'Please enter a repository name', 'error');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete repository "${repoName}"? This cannot be undone.`)) {
                return;
            }
            
            try {
                log(`Deleting repository: ${repoName}...`);
                updateStatus('repoStatus', 'Deleting repository...', 'warning');
                
                await github.deleteRepository(repoName);
                
                log(`Repository deleted successfully: ${repoName}`, 'success');
                updateStatus('repoStatus', `‚úÖ Repository deleted: ${repoName}`, 'success');
                
                // Clear repository info
                document.getElementById('repoInfo').innerHTML = '';
                
            } catch (error) {
                log(`Repository deletion failed: ${error.message}`, 'error');
                updateStatus('repoStatus', `‚ùå Deletion failed: ${error.message}`, 'error');
            }
        }
        
        async function testFileUpload() {
            const repoName = document.getElementById('testRepoName').value;
            
            if (!repoName) {
                updateStatus('uploadStatus', 'Please enter a repository name first', 'error');
                return;
            }
            
            try {
                log('Testing file upload...');
                updateStatus('uploadStatus', 'Uploading test file...', 'warning');
                
                // Create a mock repository object
                const repository = {
                    name: repoName,
                    fullName: `${github.username}/${repoName}`
                };
                
                // Create test file content
                const testContent = `# Test File
                
This is a test file created by the GitHub Integration Test.

Created at: ${new Date().toISOString()}
Repository: ${repository.fullName}

## Test Content
- Line 1
- Line 2
- Line 3
`;
                
                const appConfig = {
                    authorName: 'Test User',
                    authorEmail: 'test@example.com'
                };
                
                await github.uploadFile(repository, 'test-file.md', testContent, appConfig);
                
                log('File uploaded successfully: test-file.md', 'success');
                updateStatus('uploadStatus', '‚úÖ Test file uploaded successfully', 'success');
                
            } catch (error) {
                log(`File upload failed: ${error.message}`, 'error');
                updateStatus('uploadStatus', `‚ùå Upload failed: ${error.message}`, 'error');
            }
        }
        
        async function testGetRepositories() {
            try {
                log('Fetching user repositories...');
                updateStatus('reposStatus', 'Fetching repositories...', 'warning');
                
                const repositories = await github.getUserRepositories(1, 10);
                
                log(`Found ${repositories.length} repositories`, 'success');
                updateStatus('reposStatus', `‚úÖ Found ${repositories.length} repositories`, 'success');
                
                // Display repositories
                const reposList = document.getElementById('reposList');
                reposList.innerHTML = repositories.map(repo => `
                    <div class="repo-info">
                        <h4>üìÅ ${repo.name}</h4>
                        <p><strong>Description:</strong> ${repo.description || 'No description'}</p>
                        <p><strong>Language:</strong> ${repo.language || 'Not specified'}</p>
                        <p><strong>Stars:</strong> ${repo.stargazersCount} | <strong>Forks:</strong> ${repo.forksCount}</p>
                        <p><strong>Updated:</strong> ${new Date(repo.updatedAt).toLocaleDateString()}</p>
                        <p><strong>URL:</strong> <a href="${repo.htmlUrl}" target="_blank">${repo.htmlUrl}</a></p>
                    </div>
                `).join('');
                
            } catch (error) {
                log(`Failed to fetch repositories: ${error.message}`, 'error');
                updateStatus('reposStatus', `‚ùå Failed to fetch repositories: ${error.message}`, 'error');
            }
        }
        
        function clearLog() {
            testLog = [];
            document.getElementById('testLog').textContent = 'Log cleared.\n';
        }
        
        // Set up event listeners for GitHub integration
        github.on('auth:success', (data) => {
            log(`GitHub auth success event: ${data.username}`, 'info');
        });
        
        github.on('auth:error', (data) => {
            log(`GitHub auth error event: ${data.error.message}`, 'error');
        });
        
        github.on('repo:create:success', (data) => {
            log(`Repository creation success event: ${data.repository.fullName}`, 'info');
        });
        
        github.on('repo:create:error', (data) => {
            log(`Repository creation error event: ${data.error.message}`, 'error');
        });
        
        log('GitHub Integration Test ready. Enter your credentials and click "Test Authentication" to begin.');
    </script>
</body>
</html>
